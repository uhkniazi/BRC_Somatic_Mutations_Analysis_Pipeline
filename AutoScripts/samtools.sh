#!/bin/bash -l
#SBATCH --job-name=samtools-array
#SBATCH --array=1-8
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --time=6-05:05:00
#SBATCH --partition brc
#SBATCH --mem-per-cpu=5000MB
#SBATCH --mail-type=END,FAIL
# Autogenerated script from write_samtools_script.R
# date Tue Oct 19 12:31:08 2021
# make sure directory paths exist before running script



module load apps/samtools/1.10.0-singularity



# Parse parameter file to get variables.
           number=$SLURM_ARRAY_TASK_ID
           paramfile=samtools_param.txt
           
           ins1=`sed -n ${number}p $paramfile | awk '{print $1}'`
           bamfile=`sed -n ${number}p $paramfile | awk '{print $2}'`
           bamq30=`sed -n ${number}p $paramfile | awk '{print $3}'`
           bamq30sortn=`sed -n ${number}p $paramfile | awk '{print $4}'`
           bamq30sortnFixm=`sed -n ${number}p $paramfile | awk '{print $5}'`
           bamq30FixmSortc=`sed -n ${number}p $paramfile | awk '{print $6}'`
           bamrd=`sed -n ${number}p $paramfile | awk '{print $7}'`
           
           # 9. Run the program.
samtools view -b -S $ins1 > $bamfile
samtools view -b -q 30 $bamfile > $bamq30
samtools sort -n -o $bamq30sortn $bamq30
samtools fixmate -m $bamq30sortn $bamq30sortnFixm
samtools sort -o $bamq30FixmSortc $bamq30sortnFixm
samtools index $bamq30FixmSortc
samtools markdup -r $bamq30FixmSortc $bamrd
samtools index $bamrd



